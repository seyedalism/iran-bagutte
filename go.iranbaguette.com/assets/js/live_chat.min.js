(function(b){var a={last_activity:null,chat_status:null,active:false,start:function(){b.ajax({type:"POST",url:absolute_url+"update",dataType:"json",timeout:130*1000,cache:false,data:{last_activity:a.last_activity,chat_status:a.chat_status},success:function(c){b("#chat-status span:first").html(c.chat_status.message);if(!a.active&&c.chat_messages.chat_expired){a.stop()}if(b("#chat-content").is(":visible")){if(c.chat_messages.success){a.active=true;c.chat_messages.queue?b("#chat-queue").hide(0):b("#chat-queue").show(0);b("#chat-arrow").show(0,function(){b("#chat-loader-1").addClass("chat-hidden");b("#chat-loader-2").hide(0,function(){b("#chat-messages").html(c.chat_messages.messages)})});b("#chat-content").scrollTop(b("#chat-content")[0].scrollHeight);if(c.chat_messages.new_message){b("#audio-1").trigger("play");b("#chat-content").scrollTop(b("#chat-content")[0].scrollHeight)}c.chat_messages.operator_typing?b("#chat-operator-typing").show():b("#chat-operator-typing").hide()}else{if(a.active){a.stop()}}}else{b("#chat-arrow").show(0,function(){b("#chat-loader-1").addClass("chat-hidden")})}if(!a.active&&a.chat_status!==c.chat_status.success){if(b("#chat-form-container").is(":visible")){b("#chat-status").trigger("click")}}if(c.invitation_message.success&&!b("#chat-form-container").is(":visible")){b("#chat-alert-1").show(function(){b("#chat-alert-1 a").html(c.invitation_message.message)})}a.last_activity=c.chat_messages.last_activity;a.chat_status=c.chat_status.success;setTimeout(a.start,1000)},error:function(){setTimeout(a.start,1000)}})},stop:function(){b.ajax({type:"POST",url:absolute_url+"stop_chat",dataType:"json",success:function(c){if(c.success){a.active=false;a.chat_status=null}else{b("#chat-loader-1").addClass("chat-hidden")}}})}};a.start();b(document).ready(function(){var c;b("body").on("click","#chat-status",function(){b.ajax({type:"POST",url:absolute_url+"contact_operators",dataType:"json",cache:false,success:function(d){if(d.success){b("#chat-arrow").hide(0,function(){b("#chat-loader-1").removeClass("chat-hidden");b("#chat-loader-2").show(0,function(){b("#chat-form-container #chat-form").html(d.content)})})}else{b("#chat-form-container #chat-form").html(d.content)}}})}).on("click","#start-chat",function(d){d.preventDefault();b("#chat-form").validate({rules:{username:"required",email:{required:true,email:true},message:"required"},highlight:function(e){b(e).closest(".chat-form-group").addClass("chat-has-error")},unhighlight:function(e){b(e).removeAttr("placeholder").closest(".chat-form-group").removeClass("chat-has-error")},errorPlacement:function(e,f){f.attr("placeholder",e.text())}});if(b("#chat-form").valid()){b.ajax({type:"POST",url:absolute_url+"start_chat",dataType:"json",data:b("#chat-form").serialize(),success:function(e){if(is_mobile()){b("#chat-wrapper").height("auto")}if(e.success){b("#chat-arrow").hide(0,function(){b("#chat-loader-1").removeClass("chat-hidden");b("#chat-loader-2").show(0,function(){b("#chat-form-container #chat-form").html(e.content)})})}else{b("#chat-form-container #chat-form").html(e.content)}}})}}).on("click","#stop-chat",function(d){d.preventDefault();a.stop();b("#chat-arrow").hide(0,function(){b("#chat-loader-1").removeClass("chat-hidden")})}).on("keyup","#message",function(e){if(a.active){var d;clearTimeout(c);d=(b(this).val()=="")?0:1;c=setTimeout(function(){b.ajax({type:"POST",url:absolute_url+"typing",dataType:"json",data:{typing:d}})},150)}}).on("keydown","#message",function(d){if(a.active){clearTimeout(c)}if(d.keyCode==13){d.preventDefault();b("#send-message").trigger("click")}}).on("click","#send-message",function(d){d.preventDefault();b("#chat-form").validate({onkeyup:false,onfocusout:false,rules:{message:"required"},highlight:function(e){b(e).closest(".chat-form-group").addClass("chat-has-error")},unhighlight:function(e){b(e).removeAttr("placeholder").closest(".chat-form-group").removeClass("chat-has-error")},errorPlacement:function(e,f){f.attr("placeholder",e.text())}});if(b("#chat-form").valid()){b.ajax({type:"POST",url:absolute_url+"send_message",dataType:"json",data:b(this).parents("form").serialize(),success:function(e){clearTimeout(c);b("#chat-arrow").hide(0,function(){b("#chat-loader-1").removeClass("chat-hidden")});if(e.success){b("#chat-form")[0].reset();b.getJSON(absolute_url+"get_token",function(f){b("#token").val(f.token)})}}})}}).on("click","#chat-alert-1 button.chat-button-close",function(d){d.preventDefault();b("#chat-alert-1").hide(0);b("#chat-alert-1 a").html("&nbsp;")}).on("click","#chat-alert-1 a",function(d){d.preventDefault();b("#chat-alert-1 button.chat-button-close").trigger("click");b("#chat-status").trigger("click")}).on("click","#send-email",function(d){d.preventDefault();b("#chat-form").validate({rules:{username:"required",email:{required:true,email:true},message:"required"},highlight:function(e){b(e).closest(".chat-form-group").addClass("chat-has-error")},unhighlight:function(e){b(e).removeAttr("placeholder").closest(".chat-form-group").removeClass("chat-has-error")},errorPlacement:function(e,f){f.attr("placeholder",e.text())}});if(b("#chat-form").valid()){b("#chat-loader-2").show(0);b.ajax({type:"POST",url:absolute_url+"send_email",dataType:"json",data:b("#chat-form").serialize(),success:function(e){b("#chat-form")[0].reset();if(e.success){b("#chat-loader-2").hide(0,function(){b("#chat-alert-1").show(function(){b("#chat-alert-1 a").html(e.message)})})}else{b("#chat-loader-2").hide(0,function(){b("#chat-alert-1").show(function(){b("#chat-alert-1 a").html(e.message)})})}setTimeout(function(){b("#chat-status").trigger("click")},5000)}})}}).on("click","a#chat-sound",function(d){d.preventDefault();if(b("a#chat-sound span").hasClass("fa-volume-up")){b("a#chat-sound span").removeClass("fa-volume-up").addClass("fa-volume-off");b("#audio-1").prop("muted",true)}else{b("a#chat-sound span").removeClass("fa-volume-off").addClass("fa-volume-up");b("#audio-1").prop("muted",false)}}).on("click","#chat-status, #stop-chat",function(d){d.preventDefault();if(b("#chat-alert-1").is(":visible")){b("#chat-alert-1").hide(0)}if(b("#chat-wrapper").hasClass("active")){b("span#chat-arrow").addClass("fa-chevron-up").removeClass("fa-chevron-down");b("#chat-wrapper").animate({height:"34px"},500,function(){if(is_mobile()){b("#chat-wrapper").css("overflow-y","hidden")}b("#chat-form-container").hide(400,function(){b("#chat-form").empty();b("#chat-wrapper").height("auto")})}).removeClass("active")}else{b("#chat-wrapper").css("height","34px");b("span#chat-arrow").addClass("fa-chevron-down").removeClass("fa-chevron-up");b("#chat-form-container").show(500,function(){b("#chat-wrapper").animate({height:b("#chat-form-container").height()+34},500,function(){if(is_mobile()){b("#chat-wrapper").css("overflow-y","auto")}else{b("#chat-wrapper").height("auto")}}).addClass("active")})}})})})(jQuery);function is_mobile(){return(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/iPhone|iPad|iPod/i)||navigator.userAgent.match(/Opera Mini/i)||navigator.userAgent.match(/IEMobile/i))};