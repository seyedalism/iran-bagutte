$(document).ready(function(){var a;var c=$('<audio id="audio-1"></audio>');var b=$('<audio id="audio-2"></audio>');c.append('<source src="../assets/sounds/alert_1.ogg" type="audio/ogg">');c.append('<source src="../assets/sounds/alert_1.mp3" type="audio/mpeg">');c.append('<source src="../assets/sounds/alert_1.wav" type="audio/wav">');c.appendTo("body");b.append('<source src="../assets/sounds/alert_2.ogg" type="audio/ogg">');b.append('<source src="../assets/sounds/alert_2.mp3" type="audio/mpeg">');b.append('<source src="../assets/sounds/alert_2.wav" type="audio/wav">');b.appendTo("body");$("body").on("click","#operator-status",function(d){d.preventDefault();$("#loader-1").removeClass("hidden");$("#form-1 :button").prop("disabled",true);$.ajax({type:"POST",url:"index/update_status"})}).on("click",".start-chat",function(d){d.preventDefault();$("#loader-1").removeClass("hidden");$(this).prop("disabled",true).next(".watch-chat").prop("disabled",true);$.ajax({type:"POST",url:"index/start_chat",dataType:"json",data:{chat_id:$(this).data("id")},success:function(e){if(e.success){live_chat.active=true;$("#chat-messages").empty();$("#form-1 :button, #form-2 :input, #form-2 :button").prop("disabled",true);$("#visitor-details").closest(".panel").addClass("hidden")}}})}).on("click","#stop-chat",function(d){d.preventDefault();live_chat.stop();$("#loader-1").removeClass("hidden");$("#form-1 :button, #form-2 :input, #form-2 :button").prop("disabled",true);$("#chat-messages").empty();$("#visitor-details").closest(".panel").addClass("hidden")}).on("click",".watch-chat",function(d){d.preventDefault();$("#loader-1").removeClass("hidden");$(this).prop("disabled",true).prev(".start-chat").prop("disabled",true);$.ajax({type:"POST",url:"index/watch_chat",dataType:"json",data:{chat_id:$(this).data("id")},success:function(e){if(e.success){$("#chat-messages").empty();$("#form-1 :button, #form-2 :input, #form-2 :button").prop("disabled",true);$("#visitor-details").closest(".panel").addClass("hidden")}else{$("#loader-1").addClass("hidden")}}})}).on("click",".transfer-chat",function(d){d.preventDefault();$("#loader-1").removeClass("hidden");$.ajax({type:"POST",url:"index/transfer_chat",dataType:"json",data:{department_id:$(this).data("id")},success:function(e){if(e.success){live_chat.stop();$("#chat-messages").empty();$("#form-1 :button, #form-2 :input, #form-2 :button").prop("disabled",true);$("#visitor-details").closest(".panel").addClass("hidden")}else{$("#loader-1").addClass("hidden")}}})}).on("click","#invite-visitor",function(d){d.preventDefault();$("#online-visitors").scrollTop(0);$("#invitation-message").focus();$("#ip-address").val($(this).data("ip-address"))}).on("click","#canned-messages-2",function(d){d.preventDefault();$("#invitation-message").val($(d.target).text())}).on("keydown","#invitation-message",function(d){if(d.keyCode==13){d.preventDefault()}}).on("click","#send-invitation",function(d){d.preventDefault();$("#form-3").validate({onkeyup:false,onfocusout:false,rules:{invitation_message:"required"},highlight:function(e){$(e).closest(".form-group").addClass("has-error")},unhighlight:function(e){$(e).removeAttr("placeholder").closest(".form-group").removeClass("has-error")},errorPlacement:function(e,f){f.attr("placeholder",e.text())}});if($("#form-3").valid()){$.ajax({type:"POST",url:"index/send_invitation",dataType:"json",data:$(this).parents("form").serialize(),success:function(e){if(e.success){$("#message-success-1").removeClass("hidden").fadeIn().delay(5000).fadeOut();$("#form-3")[0].reset()}else{$("#message-success-1").fadeOut()}}})}}).on("click","#online-departments",function(d){$.ajax({type:"POST",url:"index/get_online_departments",dataType:"json",success:function(e){$("#online-departments").next("ul").html(e)}})}).on("click","#canned-messages-1",function(d){d.preventDefault();$("#message").val($(d.target).text())}).on("click","#send-message",function(d){d.preventDefault();$("#form-2").validate({onkeyup:false,onfocusout:false,rules:{message:"required"},highlight:function(e){$(e).closest(".form-group").addClass("has-error")},unhighlight:function(e){$(e).removeAttr("placeholder").closest(".form-group").removeClass("has-error")},errorPlacement:function(e,f){f.attr("placeholder",e.text())}});if($("#form-2").valid()){$("#loader-1").removeClass("hidden");$.ajax({type:"POST",url:"index/send_message",dataType:"json",data:$(this).parents("form").serialize(),success:function(e){clearTimeout(a);if(e.success){$("#form-2")[0].reset()}else{$("#form-2")[0].reset();$("#loader-1").addClass("hidden")}}})}}).on("keyup","#message",function(){var d;clearTimeout(a);d=($(this).val()=="")?0:1;a=setTimeout(function(){$.ajax({type:"POST",url:"index/typing",dataType:"json",data:{typing:d}})},150)}).on("keydown","#message",function(d){clearTimeout(a);if(d.keyCode==13){d.preventDefault();$("#send-message").trigger("click")}}).on("click","a.sound",function(d){d.preventDefault();if($("a.sound span").hasClass("fa-volume-up")){$("a.sound span").removeClass("fa-volume-up").addClass("fa-volume-off");$("#audio-1").prop("muted",true);$("#audio-2").prop("muted",true)}else{$("a.sound span").removeClass("fa-volume-off").addClass("fa-volume-up");$("#audio-1").prop("muted",false);$("#audio-2").prop("muted",false)}})});var live_chat={pending_chats_last_activity:null,chat_last_activity:null,visitors_last_activity:null,operator_status:null,active:false,start:function(){$.ajax({type:"POST",url:"index/update",dataType:"json",timeout:130*1000,cache:false,data:{pending_chats_last_activity:live_chat.pending_chats_last_activity,chat_last_activity:live_chat.chat_last_activity,visitors_last_activity:live_chat.visitors_last_activity,operator_status:live_chat.operator_status},success:function(a){if(a.pending_chats.success){$("#pending-chat").html(a.pending_chats.chat);if(a.pending_chats.new_chat){$("#audio-2").trigger("play")}}else{$("#pending-chat").html(a.pending_chats.chat)}if(a.operator_status.success){$("#operator-offline").hide(0,function(){$("#operator-online").removeClass("hidden").fadeIn(0);$("#operator-status").prop("disabled",false)})}else{$("#operator-online").hide(0,function(){$("#operator-offline").removeClass("hidden").fadeIn(0);$("#operator-status").prop("disabled",false)})}$("#visitors").html(a.online_visitors.visitors);if(a.chat_messages.chat_expired){live_chat.stop()}if(a.chat_messages.success){$("#chat-messages").html(a.chat_messages.messages);$("#chat-content").scrollTop($("#chat-content")[0].scrollHeight);$("#visitor-details").html(a.chat_messages.visitor_details).closest(".panel").removeClass("hidden");if(a.chat_messages.new_message){$("#audio-1").trigger("play");$("#chat-content").scrollTop($("#chat-content")[0].scrollHeight)}a.chat_messages.user_typing?$("#user-typing").show(0):$("#user-typing").hide(0);if(a.chat_messages.chat_active){$("#form-1 :button, #form-2 :input, #form-2 :button").prop("disabled",false)}else{$("#form-1 :button, #form-2 :input, #form-2 :button").prop("disabled",false).not("#operator-status, #stop-chat").prop("disabled",true)}}else{$("#form-1 :button, #form-2 :input, #form-2 :button").not("#operator-status, #stop-chat").prop("disabled",true)}live_chat.pending_chats_last_activity=a.pending_chats.last_activity;live_chat.chat_last_activity=a.chat_messages.last_activity;live_chat.visitors_last_activity=a.online_visitors.last_activity;live_chat.operator_status=a.operator_status.success;$("#loader-1").addClass("hidden");setTimeout(live_chat.start,1000)},error:function(){setTimeout(live_chat.start,1000)}})},stop:function(){$.ajax({type:"POST",url:"index/stop_chat",dataType:"json",success:function(a){if(a.success){live_chat.active=false}else{$("#loader-1").addClass("hidden")}}})}};